<html>
    <head>
        <title>Almost Darkness</title>
        <script src="classes/Human.js"></script>
        <script src="classes/Room.js"></script>
        <script src="classes/Random.js"></script>
        <script src="classes/Door.js"></script>
        <script src="classes/Dir.js"></script>
        <style>
        #canvas_container{margin:0 auto 0 auto; width: 1140px}
        body{background: #000}
        #gamecanvas{background:#111; border: 2px solid #ddd;}
        </style>
    </head>
    <body>
        <div id="canvas_container">
            <canvas id="gamecanvas" width="1120" height="722"></canvas>
        </div>
        <script>
            var gamecanvas = document.getElementById('gamecanvas');
            var gamecanvasC = gamecanvas.getContext('2d');
           
            var img = new Image();
            img.src = "sprite.png";

            //gamecanvasC.drawImage(img,0,0);
  
            document.addEventListener("keydown",kdh,false);

            var random = new Random(1211);
            var room = new Room(RoomType.ENTRANCE,random.nextInt(1000),true);
            var human = new Human(12,12,room);
            function kdh(event)
            {
                for(var x=0; x<room.width; x++)
                {
                    for(var y=0; y<room.height; y++)
                    {
                        var tile = room.getTile(x,y);
                       // if(tile!=-1)alert( tile instanceof Door );

                        var imgx = 0; var imgy = 0;
                        if(tile==0) { imgx = 1; imgy=0; }
                        else if(tile==1) { imgx = 2; imgy=0; }
                        else if(tile==2) { imgx = 3; imgy = 0; } 
                        else if(tile instanceof Door) { imgx = 4; imgy = 0; }
                        if(tile!=-1)gamecanvasC.drawImage(img,imgx*28,imgy*38,28,38,x*28,y*38,28,38);
                    }
                }
                if(event!=null)
                {
                if(event.keyCode==68) human.moveRight();
                else if(event.keyCode==65) human.moveLeft();
                else if(event.keyCode==87) human.moveUp();
                else if(event.keyCode==83) human.moveDown();

                }

                if(room.getTile(human.x,human.y) instanceof Door)
                {
                    var door = room.getTile(human.x,human.y);
                   
                    gamecanvasC.clearRect(0,0,1120,722);
                    room = door.toRoom;
                    if(!room.isBuild){ room._makeRoomMatrisByRandom(); door.calculateStart(); }
                    human.x = door.startx;
                    human.y = door.starty;
                    human.currentRoom = room;
                    kdh(null);

                 gamecanvasC.drawImage(img,0,0,28,38,human.x*28,human.y*38,28,38);
             }
                
                gamecanvasC.drawImage(img,0,0,28,38,human.x*28,human.y*38,28,38);
            }

        </script>
    </body>
</html>
